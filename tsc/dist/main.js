(()=>{"use strict";var t=function(t,i,e,s){return new(e||(e=Promise))((function(n,c){function o(t){try{h(s.next(t))}catch(t){c(t)}}function l(t){try{h(s.throw(t))}catch(t){c(t)}}function h(t){var i;t.done?n(t.value):(i=t.value,i instanceof e?i:new e((function(t){t(i)}))).then(o,l)}h((s=s.apply(t,i||[])).next())}))};class i{constructor(t){this.runtime=t,this.initialized=!1,this.objectsInitialized=!1,this.initialBubblePositions=null,this.mainObjectMap=null,this.objectsList=[],this.userCanPop=!0,this.bubbleList=[],this.createdObjectList=[],this.newBubble=null,this.coinList=[],this.intervalID=null,this.coinsGenerated=0,this.runtime.addEventListener("beforeprojectstart",(()=>this.onBeforeProjectStart()))}onBeforeProjectStart(){this.runtime.addEventListener("tick",(()=>this.tick()))}init(i){return t(this,void 0,void 0,(function*(){if(!this.initialized){const t=yield this.runtime.assets.getProjectFileUrl("Main.json"),e=yield this.runtime.assets.fetchJson(t);this.initialBubblePositions=e.initialBubblePositions,this.mainObjectMap=e.objectMap,this.initializeSelectedObjects(i),this.initialized=!0}yield this.setupScene()}))}initializeSelectedObjects(t){t.forEach((t=>{if(t.sound in this.mainObjectMap){const i=this.mainObjectMap[t.sound];if(t.placement&&t.placement in i)this.objectsList.push(...i[t.placement]);else if(Array.isArray(i))this.objectsList.push(...i);else for(const t in i)this.objectsList.push(...i[t])}})),this.objectsList=[...new Set(this.objectsList)]}setupScene(){return t(this,void 0,void 0,(function*(){if(this.runtime.objects.bubblepopspritesheet.getAllInstances().forEach((t=>{t.destroy()})),this.objectsInitialized){for(let t=0;t<this.bubbleList.length;++t){const i=this.bubbleList[t];null!=i&&i.uid>0&&(yield this.runtime.callFunction("attachObject",this.createdObjectList[t].uid,i.uid))}if(this.objectsList.length>0){const t=yield this.runtime.objects.Bubble.createInstance(0,-300,500);t.width=400,t.height=400,this.bubbleList.push(t);const i=this.objectsList.splice(Math.floor(Math.random()*this.objectsList.length),1)[0];t.instVars.childObject=i;const e=yield this.runtime.objects[i].createInstance(0,-300,500);e.width=300,e.height=300,e.instVars.name=i,e.behaviors.Physics.isEnabled=!1,this.createdObjectList.push(e),yield this.runtime.callFunction("setupBubblePhysics",t.uid),yield this.runtime.callFunction("attachObject",e.uid,t.uid),this.newBubble=t}}else{this.runtime.objects.Bubble.getAllInstances().forEach((t=>{t.destroy()}));const t=this.objectsList.length;for(let i=0;i<this.initialBubblePositions.length&&i<t;++i){const t=this.initialBubblePositions[i][0],e=this.initialBubblePositions[i][1],s=yield this.runtime.objects.Bubble.createInstance(0,t,e);s.behaviors.Physics.isEnabled=!1,s.width=400,s.height=400,this.bubbleList.push(s);const n=this.objectsList.splice(Math.floor(Math.random()*this.objectsList.length),1)[0];s.instVars.childObject=n;const c=yield this.runtime.objects[n].createInstance(0,t,e);c.width=300,c.height=300,c.instVars.name=n,c.behaviors.Physics.isEnabled=!1,this.createdObjectList.push(c),yield this.runtime.callFunction("attachObject",c.uid,s.uid),yield this.runtime.callFunction("setupBubblePhysics",s.uid)}this.objectsInitialized=!0}yield this.runtime.callFunction("initCrabPosition")}))}bubbleTapped(i){return t(this,void 0,void 0,(function*(){if(this.userCanPop){this.userCanPop=!1;const t=i.instVars.childObject;yield this.runtime.objects.bubblepopspritesheet.createInstance(0,0,0),yield this.runtime.callFunction("popBubble",i.uid),yield this.runtime.callFunction("dropObject",t)}}))}launchCrab(){return t(this,void 0,void 0,(function*(){}))}intercept(i,e,s){return t(this,void 0,void 0,(function*(){let t=e.getImagePoint("crabloc"),s=i.x-t[0],n=i.y-(t[1]+600),c=Math.sqrt(s*s+n*n);yield this.runtime.callFunction("fireCrab",c,e.uid)}))}quad(t,i,e){var s=null;if(Math.abs(t)<1e-6)s=Math.abs(i)<1e-6?Math.abs(e)<1e-6?[0,0]:null:[-e/i,-e/i];else{var n=i*i-4*t*e;n>=0&&(s=[(-i-(n=Math.sqrt(n)))/(t*=2),(-i+n)/t])}return s}tick(){null!==this.newBubble&&this.newBubble.x<200?this.newBubble.x+=1:null!==this.newBubble&&(this.runtime.callFunction("setupBubblePhysics",this.newBubble.uid),this.newBubble=null)}}var e=function(t,i,e,s){return new(e||(e=Promise))((function(n,c){function o(t){try{h(s.next(t))}catch(t){c(t)}}function l(t){try{h(s.throw(t))}catch(t){c(t)}}function h(t){var i;t.done?n(t.value):(i=t.value,i instanceof e?i:new e((function(t){t(i)}))).then(o,l)}h((s=s.apply(t,i||[])).next())}))};!function(){let t=null;runOnStartup((s=>e(this,void 0,void 0,(function*(){t||(t=new i(s))})))),globalThis.main__init=()=>e(this,void 0,void 0,(function*(){yield t.init(globalThis.main__loadSounds)})),globalThis.main__bubble_tapped=i=>e(this,void 0,void 0,(function*(){yield t.bubbleTapped(i)})),globalThis.main__object_tapped=()=>e(this,void 0,void 0,(function*(){t.userCanPop=!0})),globalThis.main__coinFinished=()=>e(this,void 0,void 0,(function*(){yield t.coinFinished()})),globalThis.main__setup_projectile=(i,s)=>e(this,void 0,void 0,(function*(){t.intercept(s,i,400)}))}()})();